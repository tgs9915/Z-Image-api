# Z-Image Next.js 快速开始指南

## 🚀 快速启动 (3 分钟)

### 1. 克隆/进入项目目录

```bash
cd e:/z-image
```

### 2. 安装依赖

```bash
npm install
```

如果遇到权限问题，使用：
```powershell
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
npm install
```

### 3. 配置环境变量

创建 `.env.local` 文件：

```bash
# Windows PowerShell
Copy-Item .env.example .env.local
```

或手动创建 `.env.local` 并添加以下内容：

```bash
# JWT 密钥
JWT_SECRET=my-secret-key-change-this-in-production

# 控制台登录
CONSOLE_USERNAME=admin
CONSOLE_PASSWORD=admin123

# API 密钥 (可选，留空则不验证)
API_KEYS=sk-test-key-001

# 公开 URL
NEXT_PUBLIC_BASE_URL=http://localhost:3000

# Z-Image API
ZIMAGE_API_URL=https://mrfakename-z-image-turbo.hf.space

# 代理池配置
PROXY_POOL_ENABLED=true
PROXY_POOL_MAX_DAILY=5

# 代理源 (可选，留空使用默认的 7 个 SOCKS5 代理源)
# 默认代理源与 Python 源码一致，无需配置即可使用
# 如需自定义代理源，取消下面的注释并修改：
# PROXY_SOURCES=https://example.com/proxy1.txt,https://example.com/proxy2.txt
```

> 💡 **提示**: 项目已内置 7 个免费 SOCKS5 代理源（与原 Python 源码一致），无需额外配置。详见 `代理源配置说明.md`。


### 4. 启动开发服务器

```bash
npm run dev
```

### 5. 访问应用

打开浏览器访问:
- 控制台: http://localhost:3000
- 登录使用: `admin / admin123`

## 📝 注意事项

### 本地开发限制

⚠️ **重要**: 由于本地开发环境没有 Vercel KV 和 Blob，以下功能会受限：

1. **无法持久化数据**: 
   - 代理池数据
   - 模型配置
   - 生成历史
   - 系统设置

2. **无法存储图片**:
   - 生成的图片无法保存到 Blob
   - 需要配置 Vercel Blob 才能正常工作

### 解决方案

#### 方案 1: 模拟存储 (推荐本地测试)

创建 mock 数据文件，临时替代 KV/Blob (需要修改代码)

#### 方案 2: 连接 Vercel 开发环境

```bash
# 安装 Vercel CLI
npm i -g vercel

# 链接项目
vercel link

# 拉取环境变量
vercel env pull .env.local

# 启动开发
vercel dev
```

这样可以使用 Vercel 的 KV 和 Blob 服务。

#### 方案 3: 直接部署到 Vercel (推荐)

跳过本地测试，直接部署到 Vercel：

```bash
# 初始化 git
git init
git add .
git commit -m "Initial commit"

# 推送到 GitHub
# 然后在 Vercel Dashboard 导入项目
```

参考 `DEPLOY.md` 获取详细部署步骤。

## 🧪 测试 API

### 方式 1: cURL

```bash
# 获取模型列表
curl http://localhost:3000/api/v1/models \
  -H "Authorization: Bearer sk-test-key-001"

# 生成图片 (流式)
curl http://localhost:3000/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer sk-test-key-001" \
  -d '{
    "model": "Z-Image",
    "messages": [{"role": "user", "content": "一只可爱的猫咪"}],
    "stream": true
  }'
```

### 方式 2: Postman

1. 导入 API 集合 (如果有)
2. 设置 Authorization: Bearer Token
3. 测试各个端点

### 方式 3: 使用现有客户端

任何支持 OpenAI API 的客户端都可以使用，只需修改：
- Base URL: `http://localhost:3000`
- API Key: `sk-test-key-001`

## 🐛 常见问题

### Q1: `npm install` 失败

**错误**: PowerShell 脚本执行策略

**解决**:
```powershell
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
```

### Q2: 端口 3000 被占用

**解决**:
```bash
# 使用其他端口
PORT=3001 npm run dev
```

或在 `package.json` 中修改 dev 脚本：
```json
"dev": "next dev -p 3001"
```

### Q3: TypeScript 报错

**正常现象**: 未安装依赖前会有很多 TS 错误

**解决**: 运行 `npm install` 后会消失

### Q4: API 调用失败

**检查**:
1. 是否配置了 API_KEYS
2. Authorization 头是否正确
3. Content-Type 是否为 application/json

### Q5: 页面空白

**检查**:
1. 浏览器控制台错误
2. 终端是否有报错
3. 尝试清除浏览器缓存

## 📁 项目结构速查

```
z-image/
├── app/                  # Next.js 应用
│   ├── api/             # API 路由 (Serverless Functions)
│   ├── dashboard/       # 控制台页面
│   ├── page.tsx         # 登录页
│   └── globals.css      # 全局样式
├── lib/                 # 工具库
│   ├── auth.ts          # 认证
│   ├── config.ts        # 配置
│   ├── zimage.ts        # Z-Image API
│   └── ...
├── .env.local           # 环境变量 (需创建)
├── package.json         # 依赖配置
└── README.md            # 项目文档
```

## 🔧 开发命令

```bash
# 启动开发服务器
npm run dev

# 生产构建
npm run build

# 启动生产服务器
npm start

# 代码检查
npm run lint
```

## 📚 下一步

1. ✅ 完成本地环境配置
2. 📖 阅读 `README.md` 了解完整功能
3. 🚀 阅读 `DEPLOY.md` 了解如何部署
4. 🎨 根据需求自定义配置和样式

## 💡 提示

- **本地测试**: 主要测试 UI 和 API 逻辑
- **Vercel 测试**: 测试完整功能（含存储）
- **生产部署**: 按 DEPLOY.md 步骤操作

祝开发顺利！🎉

有问题随时查看文档或提 Issue。
